---
title: "QTL Candidate Annotation for MR network"
output: html_notebook
---

## Background

Rob Baker et al fit growth parameters to B. rapa growth data and then used those to do function-value-trait QTL mapping and to find genes under those peaks

I used that same function-value-trait data to query a mutual rank (MR) gene expression network that I had built.  This returned genes that were in a networks associated with the growth paramters.  This was done separeately for the CR and UN environments.  (Currently we are only focused on the UN environment)

Here I want to annotate candidate QTL genes with:

1. Are any network genes under the QTL peaks?  I have used Mutual Rank to define gene networks around the plant growth traits.  I am curious as to whether or not any of the genes in these networks underlie QTLs for these traits.

2. The degree of differential expression among the lines for the growth QTL genes.

```{r}
library(tidyverse)
library(magrittr)
library(limma)
```

## Annotation with MR network membership

```{r}
QTLgenes <- read_csv("../input/BrapaNetworks/Heigh2012_uniquegenes.csv")[,-1]
summary(QTLgenes)
QTLgenes
```

```{r}
MR_UN_genes <- read_csv("../output/MR_UN_graphs_annotation.csv")
summary(MR_UN_genes)
MR_UN_genes
```

```{r}
QTLgenes$UN_network <- MR_UN_genes$.id[match(QTLgenes$name, MR_UN_genes$name)]
```

```{r}
QTLgenes %>% filter(!is.na(UN_network) )
```

## Annotation with DE information

```{r}
load("../output/Voom_UN.Rdata")
```

```{r}
RIL.coefs.UN <- grep("RIL",colnames(coef(voom.fit.UN)))
RIL.pvals.UN <- topTable(voom.fit.UN,coef = RIL.coefs.UN,number = Inf)
```

```{r}
RIL.pvals.UN$rank_F <- rank(RIL.pvals.UN$F)

RIL.pvals.UN %<>% select(-starts_with("pdata"))
colnames(RIL.pvals.UN) %<>% paste(".UN",sep="")
```

```{r}
QTLgenes <- merge(QTLgenes, RIL.pvals.UN, by.x="name", by.y=0,all.x = TRUE, all.y = FALSE)
```

```{r}
write_csv(QTLgenes,"../output/Heigh2012_uniquegenes_DE_MR_UN.csv")
```
